---
title: "PRA2"
author: "Erola Fenollosa i Xavier Pasquet"
date: "22 desembre de 2021"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# MEMÒRIA PRA2

### 0. Introducció
Aquest arxiu conté els apartats de la memòria de la **PRA2** juntament amb el codi per a respondre a les preguntes. Per tant el punt 7 de la memòria queda integrat en aquest mateix arxiu.


### 1. Descripció del dataset. Perquè és important i quina pregunta/problema pretén respondre? 
descripció dataset
perquè és important


Tal i com presentavem en la PRA1 (https://github.com/erolafr/InvasivePlantsScraper/blob/main/Mem%C3%B2riaPRA1.pdf), el dataset “Biodiversitat arbustiva i arbòria nativa i invasora a Espanya”. 

Preguntes:
Biodiversitat i riquesa nativa i invasora en les diferents regions.
Rànquing de províncies amb  més diversitats i riquesa.
Correlació entre biodiversitat i riquesa nativa i invasora.
Qualitat de l’arbrat i la seva relació amb la biodiversitat,i riquesa tant nativa com invasora.

Explicar hipotesis i conceptes: indexs, què signifiquen les variables…

### 2. Integració i selecció de les dades d’interès a analitzar. 
Incorporem les llibreries necesaries
```{r}
library(dplyr)
library(ggplot2)
```

Importem el csv
```{r}
ifn3 <- read.csv("ifn3.csv")
```

Revisió de quines variables hi ha i fer subset d’algunes
```{r}
#Revisem l'estructura global del dataset importat
str(ifn3)


# Seleccionem les variables d'interès
ifn3_subset <- select(ifn3, c(Estadillo, Especie, Calidad, Provincia, Is_invasive))

# Visualitzem el dataset filtrat:
head(ifn3_subset)
```

### 3. Neteja de les dades. 
#### 3.1. Les dades contenen zeros o elements buits? Com gestionaries aquests casos?
Comptabilitzar casos amb zeros o elements buits en valor absolut i en percentatge per cada variable
```{r}
colSums(is.na(ifn3_subset))
```
Hi ha uns quans valors nuls de qualitat. Visualizem un resum de les dades originals amb nulls a  qualitat:

```{r}
summary(ifn3[is.na(ifn3$Calidad),])
```
S'observa que els que tenen espècie i qualitat null són arbres que es van inventariar en l'IFN2 i no s'han pogut inventariar el l'IFN3 (tenen Orden If3 = 0).
Com que vull centrar-me només amb dades de l'IFN3 i no m'interesa comparara dades amb l'IFN2, descarto aquests valors.

```{r }
# Elimino files amb espècie i qualitat nulls
ifn3_subset <- ifn3_subset[!is.na(ifn3_subset$Calidad),]
```

#### 3.2. Identificació i tractament de valors extrems. 
generar histogrames per a atributs numerics i frequencia de casos en categorics. 
```{r}
# Gràfic de freqüències d'"Estadillo":
ggplot(ifn3_subset, aes(x = Estadillo)) + geom_histogram(bins = 30, color = "black", fill = "gray")
```

```{r}
# Especie
ggplot(ifn3_subset, aes(Especie)) +
  geom_bar(fill = "#0073C2FF")

# Preparem un plot amb les 10 més abundants i amb les menys abundants
sp_count <- ifn3_subset %>%
  group_by(Especie) %>%
  summarise(counts = n()) %>%
  arrange(desc(counts))

sp_top10 <- sp_count[1:10,]
sp_last10 <- tail(sp_count,10)

ggplot(data=sp_top10, aes(x=Especie, y=counts)) +  geom_bar(stat="identity") +coord_flip() + ggtitle("Top 10 espècies amb més registres")
ggplot(data=sp_last10, aes(x=Especie, y=counts)) +  geom_bar(stat="identity") +coord_flip() + ggtitle("Top 10 espècies amb menys registres")

```

Revisem "Calidad"
```{r}
ggplot(ifn3_subset, aes(x = Calidad)) + geom_histogram(bins = 40, color = "black", fill = "gray")

#Revisem el valor màxim i mínim
summary(ifn3_subset$Calidad)

```
Tal i com veiem en l'histograma i també en mínim i màxim, la variable Calidad pren algun valor superior a les categories establertes (entre 1 i 6), revisem quants valors hi ha superiors a 6 i els eliminem:
```{r}
sum(ifn3_subset$Calidad>6) # Hi ha 9 valors erronis

ifn3_subset <-ifn3_subset[!c(ifn3_subset$Calidad>6),] # Els eliminem

#Tornem a fer l'histograma:
ggplot(ifn3_subset, aes(x = Calidad)) + geom_histogram(bins = 6, color = "black", fill = "gray")
```

Revisem "Provincia"
```{r}
ggplot(ifn3_subset, aes(x = Provincia)) + geom_histogram(bins = 40, color = "black", fill = "gray")
summary(ifn3_subset$Provincia)
```
És correcte, tenim dades de 1 a 50.


Revisem "Is_invasive":
```{r}
# Revisem quins valors pren Is_invasive:
unique(ifn3_subset$Is_invasive)

#Revisem quants valors hi ha de cada classe:
ifn3_subset %>%
  group_by(Is_invasive) %>%
  summarise(counts = n())
```




### 4. Anàlisi de les dades. 
#### 4.1. Selecció dels grups de dades que es volen analitzar/comparar (planificació dels anàlisis a aplicar). 
En primer lloc, creació de noves variables per provincia (nou dataset per provincia)
```{r}
#riquesa per provincia
#indexs de biodiversitat per provincia
```
Indexs: Simpson, Shannon, Margalef.

per la variable de qualitat farem la mitjana de la província i també error estàndard.


Creació de grups depen de si tenen invasores o no, en cada parcela mirar si té alguna invasora o cap i agrupar en una variable. Variable que sigui “conté invasora”.
```{r}
ifn_par <- ifn3_subset %>% group_by(Estadillo) %>% summarise(calidad = mean(Calidad), conte_invasora = max(Is_invasive))
```

#### 4.2. Comprovació de la normalitat i homogeneïtat de la variància. 
comprovem normalitat:
```{r}

```

comprovem homogeneitat de variancies:
```{r}

```

comentem resultats.

#### 4.3. Aplicació de proves estadístiques per comparar els grups de dades. En funció de les dades i de l’objectiu de l’estudi, aplicar proves de contrast d’hipòtesis, correlacions, regressions, etc. Aplicar almenys tres mètodes d’anàlisi diferents. 

Contrast d’hipotesis de si les parceles amb alguna invasora tenen millor qualitat o menys biodiversitat que les que no.
```{r}

```

Correlació entre biodiversitat nativa de la provincia i la biodiversitat invasora de la provincia
```{r}

```

Correlació entre biodiversitat invasora i qualitat de l’arbrat
```{r}

```


### 5. Representació dels resultats a partir de taules i gràfiques. 
resultats de riquesa i biodiversitat per provincia
```{r}

```

ranquing per provincia
```{r}

```

taula anova, p-valors del contrast d’hipotesi
```{r}

```

grafics de correlacions
```{r}

```

### 6. Resolució del problema. A partir dels resultats obtinguts, quines són les conclusions? Els resultats permeten respondre al problema?
Conclusions. Redactar.

### 7. Codi: Cal adjuntar el codi, preferiblement en R, amb el que s’ha realitzat la neteja, anàlisi i representació de les dades. Si ho preferiu, també podeu treballar en Python
Explicar que el codi està aquí


### Taula de contribucions:

Contribucions
Firma
Investigació prèvia


Redacció de les respostes


Desenvolupament del codi




